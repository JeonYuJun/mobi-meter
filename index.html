<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모비미터 - Mobi Meter</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <!-- Chart.js zoom plugin for pan/zoom functionality -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    
    <!-- ========== 외부 CSS 파일 로드 ========== -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="panel">
            <div class="options-bar"> 
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button class="btn btn-with-text" id="connectBtn">
                        <i class="fas fa-plug"></i>
                        <span class="btn-text">연결</span>
                        <span id="connectSym" class="status-indicator"></span>
                    </button>
                    <button id="clearBtn" class="btn btn-with-text">
                        <i class="fas fa-trash"></i>
                        <span class="btn-text">초기화</span>
                    </button>
                    <button id="saveAllBtn" class="btn btn-with-text">
                        <i class="fas fa-save"></i>
                        <span class="btn-text">저장</span>
                    </button>
                    <button id="loadAllBtn" class="btn btn-with-text">
                        <i class="fas fa-folder-open"></i>
                        <span class="btn-text">불러오기</span>
                    </button>
                    <div class="btn-group">
                        <button id="exportBtn" class="btn btn-with-text">
                            <i class="fas fa-file-export"></i>
                            <span class="btn-text">내보내기</span>
                        </button>
                        <div id="exportMenu" class="dropdown-menu" style="display: none;">
                            <button class="dropdown-item" onclick="exportScreenshot()">
                                <i class="fas fa-camera"></i> 스크린샷
                            </button>
                            <button class="dropdown-item" onclick="exportCSV()">
                                <i class="fas fa-file-csv"></i> CSV 다운로드
                            </button>
                            <button class="dropdown-item" onclick="copyToClipboard()">
                                <i class="fas fa-clipboard"></i> 클립보드 복사
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 8px; align-items: center;">
                    <label for="calcmodechkbox" style="display: flex; align-items: center; gap: 6px;">
                        <i class="fas fa-calculator"></i>
                        <select id="calcmodechkbox" class="combobox" name="calcmode">
                            <option value="all">모두</option>
                            <option value="highest_hp">최대 HP</option>
                            <option value="most_attacked">딜 집중</option>
                        </select>
                    </label>
                    <label class="tooltip" style="display: flex; align-items: center; gap: 6px;">
                        <i class="fas fa-bullseye"></i>
                        <input type="checkbox" id="singleModeCheckbox">
                        <span class="tooltip-text">허수아비 모드</span>
                    </label>
                </div>
                
                <button id="settingsBtn" class="btn btn-with-text" style="margin-left: auto;">
                    <i class="fas fa-cog"></i>
                    <span class="btn-text">설정</span>
                </button>
            </div>
        </div>
        
        <!-- 실시간 DPS 차트 -->
        <div class="panel" id="chartPanel" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0; font-size: 1.1em; color: var(--text-color);">
                    <i class="fas fa-chart-area" style="color: var(--primary-color);"></i> 실시간 DPS 추이
                </h3>
                <div style="display: flex; gap: 6px; align-items: center;">
                    <button class="btn tooltip" onclick="if(dpsChart) dpsChart.resetZoom();">
                        <i class="fas fa-home"></i>
                        <span class="tooltip-text">차트 위치 초기화</span>
                    </button>
                    <span style="font-size: 0.8em; color: var(--text-dim);">
                        <i class="fas fa-info-circle"></i> 드래그: 좌우 이동
                    </span>
                </div>
            </div>
            <div style="position: relative; height: 200px; background: var(--bg-soft); border-radius: 8px; padding: 10px;">
                <canvas id="realtimeDPSChart" style="max-height: 180px;"></canvas>
            </div>
        </div>
        
        <div class="panel">
            <div class="meter-wrapper">
                <div id="runtime-display" class="my-text-box tooltip">
                    <i class="fas fa-clock"></i>
                    전투 시간: <span id="runtime-text">0.00초</span>
                    <span class="tooltip-text">전투가 진행된 총 시간</span>
                </div>
                <div id="runtime-total" class="my-text-box tooltip">
                    <i class="fas fa-fire"></i>
                    전체 딜량: <span id="total-text">0</span>
                    <span class="tooltip-text">파티원 전체가 입힌 총 데미지</span>
                </div>
                <div id="runtime-total" class="my-text-box tooltip">
                    <i class="fas fa-chart-line"></i>
                    전체 DPS: <span id="total-dps-text">0</span>
                    <span class="tooltip-text">파티원 전체의 초당 데미지</span>
                </div>
            </div>
            <hr class="divider">
            <div id="damage-stats-list" class="damage-cards-container"></div>
        </div>
        <div id="detail-panel" class="panel detail-panel">
            <div id="detail-title-panel"  style="padding: 8px 0px;"></div>
            <hr class="divider">
            <div id="stat-detail-panel"  style="padding: 8px 12px;">
                <div class="detail-stats">
                    <div class="meter-wrapper">
                        <div class="my-text-box">크리 확률:<span class="detail-value">0%</span></div>
                        <div class="my-text-box">추가타 확률:<span class="detail-value">0%</span></div>
                        <div class="my-text-box">평균 공증:<span class="detail-value">0%</span></div>
                        <div class="my-text-box">평균 피증:<span class="detail-value">0%</span></div>
                    </div>
                    <div class="my-text-box" style="display: block; width: 100%;">
                        <div id="buff-radio-groups" style="display: flex; align-items: center; gap:12px;">
                            <div class="btn">전체</div>
                            <div class="btn">룬</div>
                            <div class="btn">스킬</div>
                            <div class="btn">시너지</div>
                            <div class="btn">적</div>
                            <div class="btn">펫</div>
                            <div style="color: var(--text-dim)">(버프 가동률 / 최대 스택)</div>
                        </div>
                        <div class="buff-list" style="display: flex; align-items: flex-start; flex-wrap: wrap; gap:12px; margin:20px 0px">
                            
                        </div>
                        <div class="buff-list" style="display: flex; align-items: flex-start; gap:12px; margin-top:10px">
                            
                        </div>
                    </div>
                </div>
            </div>
            <hr class="divider">
            <div id="skill-detail-panel" style="padding: 0px 6px; font-size: 1.13em"></div>
        </div>
    </div>
    <!-- ========== JavaScript 외부 파일 로드 ========== -->
    <script src="app.js"></script>
    
    <!-- 상세정보 모달 -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">상세 정보</h2>
                <button class="modal-close" onclick="document.getElementById('detailModal').classList.remove('open')">
                    <i class="fas fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 동적으로 내용 추가 -->
            </div>
        </div>
    </div>

    <!-- 설정 패널 -->
    <div id="settingsPanel">
        <div class="settings-header">
            <h3 style="margin: 0; color: var(--text-color);">
                <i class="fas fa-cog" style="color: var(--primary-color);"></i> 설정
            </h3>
            <button id="settingsClose" style="background: transparent; border: none; color: var(--text-color); font-size: 1.5em; cursor: pointer; padding: 0;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="settings-content">
            <div class="setting-item">
                <div class="setting-label">
                    <span><i class="fas fa-chart-line"></i> 실시간 차트 표시</span>
                    <div class="toggle-switch active" id="chartToggle"></div>
                </div>
                <p style="font-size: 0.85em; color: var(--text-dim); margin: 4px 0 0 0;">DPS 추이를 실시간으로 확인합니다.</p>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span><i class="fas fa-magic"></i> 애니메이션 효과</span>
                    <div class="toggle-switch active" id="animationToggle"></div>
                </div>
                <p style="font-size: 0.85em; color: var(--text-dim); margin: 4px 0 0 0;">UI 애니메이션을 활성화합니다.</p>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span><i class="fas fa-bell"></i> 자동 초기화</span>
                    <div class="toggle-switch active" id="autoResetToggle"></div>
                </div>
                <p style="font-size: 0.85em; color: var(--text-dim); margin: 4px 0 0 0;">설정 시간 동안 데이터가 없으면 자동으로 초기화합니다.</p>
                <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <label style="font-size: 0.85em; color: var(--text-dim);">대기 시간:</label>
                    <input type="number" id="autoResetTime" min="30" max="180" value="60" style="width: 60px; padding: 4px 8px; background: var(--bg-soft); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-color);">
                    <span style="font-size: 0.85em; color: var(--text-dim);">초 (30~180)</span>
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span><i class="fas fa-palette"></i> 테마 선택</span>
                </div>
                <select id="themeSelect" class="combobox" style="width: 100%; margin-top: 8px;">
                    <option value="dark">다크 테마 (기본)</option>
                    <option value="soft-dark">소프트 다크</option>
                    <option value="high-contrast">고대비</option>
                    <option value="minimal">미니멀 다크</option>
                </select>
                <p style="font-size: 0.85em; color: var(--text-dim); margin: 4px 0 0 0;">UI 색상 테마를 변경합니다.</p>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span><i class="fas fa-th"></i> 뷰 모드</span>
                </div>
                <select id="viewModeSelect" class="combobox" style="width: 100%; margin-top: 8px;">
                    <option value="card">카드형</option>
                    <option value="list">리스트형</option>
                </select>
                <p style="font-size: 0.85em; color: var(--text-dim); margin: 4px 0 0 0;">데미지 통계 표시 방식을 변경합니다.</p>
            </div>
        </div>
    </div>
    
</body>
</html>