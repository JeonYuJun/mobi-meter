# 🐱 Mobi-Meter (마비노기 데미지 미터)

마비노기 MMORPG용 실시간 전투 데이터 분석 도구입니다. 네트워크 패킷을 캡처하여 데미지, 스킬, 버프 정보를 실시간으로 분석하고 웹 인터페이스로 표시합니다.

![Version](https://img.shields.io/badge/version-1.0.7-blue)
![Platform](https://img.shields.io/badge/platform-Windows-lightgrey)

## 실행 환경

- Windows 환경
- **Npcap** 설치 필수 ([다운로드](https://npcap.com/#download))
- ⚠️ **주의**: 일부 게임은 Npcap 실행을 감지하여 제재할 수 있으므로 주의가 필요합니다.

## 실행 방법

### 간단 실행 (권장)
1. **mobi-meter.exe 실행**
   - 자동으로 관리자 권한 요청 (UAC 프롬프트)
   - 브라우저가 자동으로 열립니다
   - 하나의 exe 파일만으로 실행 가능 (독립 실행형)

### 수동 실행 (개발용)
1. 관리자 권한으로 `python main.py` 실행
2. 브라우저가 자동으로 `http://localhost:8081` 열기
3. WebSocket은 `ws://localhost:8080`에 자동 연결

## UI 구성

### 상단 컨트롤
- **연결**: WebSocket 서버 연결 상태 및 재연결
- **초기화**: 모든 전투 데이터 초기화
- **저장**: 현재 전투 데이터를 파일로 저장
- **불러오기**: 저장된 전투 데이터 불러오기
- **내보내기**: 스크린샷, CSV, 클립보드 복사
- **설정**: 테마, 뷰 모드, 자동 초기화 등 설정

### 전투 정보
- **전투 시간**: 전투가 진행된 총 시간
- **전체 딜량**: 파티원 전체가 입힌 총 데미지
- **전체 DPS**: 파티원 전체의 초당 데미지

### 실시간 DPS 차트
- 플레이어별 DPS 추이를 실시간 그래프로 표시
- 최대 30분간의 전투 데이터 표시 (3600 데이터 포인트)
- 마우스 휠로 확대/축소 가능
- 줌 초기화 버튼으로 전체 보기
- 평균선 및 피크 마커 표시

### 플레이어 순위
- **하이브리드 카드뷰**: 상위 3명은 카드형, 나머지는 리스트형으로 표시
- **리스트형 뷰**: 간결한 표 형태
- 실시간 DPS, 총 데미지, 점유율 표시
- 치명타율, 추가타율, 평균 공증/피증 표시
- 순위별 시각적 구분 (#1 금색, #2 은색, #3 동색)

### 상세 정보 모달 (더블클릭 시)
- **플레이어 요약**: 총 데미지, DPS, 점유율
- **기본 통계**: 크리티컬 확률, 추가타 확률, 평균 공증/피증
- **개인 DPS 추이 차트**: 전체 전투 시간 동안의 개인 DPS 그래프
- **버프 가동률**: 
  - 전체/룬/스킬/시너지/적/펫 카테고리별 필터
  - 버프별 가동률 및 최대 스택 표시
- **스킬별 상세**:
  - 스킬명, 총 데미지, 평균 공증/피증, 치명타율, 추가타율
  - 클릭 시 일반/도트/특수 데미지 상세 정보
- **이미지 내보내기**: 모달 내용을 이미지로 다운로드 또는 클립보드 복사

## 설정 기능

### 실시간 차트 표시
- DPS 추이 그래프 표시 여부 설정

### 애니메이션 효과
- UI 전환 애니메이션 켜기/끄기

### 자동 초기화
- 설정된 시간 동안 데이터가 없으면 자동으로 초기화
- **시간 설정**: 30~180초 범위에서 설정 가능 (기본 60초)
- 알림 없이 조용히 초기화됨

### 테마 선택
- **다크 테마** (기본): 부드러운 보라색 톤의 다크 테마
- **소프트 다크**: 파란색 계열의 부드러운 다크 테마
- **고대비**: 흑백 위주의 명확한 대비 테마
- **미니멀 다크**: 최소한의 색상을 사용한 깔끔한 테마

### 뷰 모드
- **카드형**: 하이브리드 카드 레이아웃 (상위 3명 카드 + 나머지 리스트)
- **리스트형**: 간결한 표 형태 레이아웃

## 주요 기능

### 실시간 분석
- 네트워크 패킷 캡처를 통한 실시간 데미지 측정
- 다중 플레이어 동시 측정 및 비교
- 2Hz 업데이트 주기로 부드러운 실시간 갱신
- 최대 30분간의 전투 데이터 추적

### 상세 분석
- 스킬별 데미지 분포 및 효율 분석
- 일반/도트/특수 데미지 구분
- 버프별 가동률 및 스택 관리 분석
- 치명타율, 추가타율, 평균 공증/피증 계산

### 데이터 관리
- **저장/불러오기**: JSON 형식으로 전투 데이터 저장
- **내보내기 옵션**:
  - 스크린샷 (PNG)
  - CSV 다운로드
  - 클립보드 복사

### 자동화 기능
- 브라우저 자동 실행
- WebSocket 자동 연결
- 30초간 연결이 없으면 자동 종료
- 설정 시간 후 자동 데이터 초기화

## 기술 사양

### 백엔드 (Python)
- **WebSocket 서버**: 포트 8080
- **HTTP 서버**: 포트 8081 (독립 실행형 exe용)
- **패킷 캡처**: Scapy를 통한 TCP 포트 16000 모니터링
- **데이터 압축**: Brotli 압축 사용
- **업데이트 주기**: 500ms (2Hz)

### 프론트엔드 (웹)
- **프레임워크**: 순수 JavaScript (프레임워크 없음)
- **차트**: Chart.js 4.4.0
- **아이콘**: Font Awesome 6.4.0
- **WebSocket 클라이언트**: 자동 재연결 지원

## 문제 해결

### exe 실행 시 오류
- Npcap이 설치되어 있는지 확인
- Windows Defender나 백신 프로그램에서 차단하는지 확인
- UAC 프롬프트에서 '예'를 선택했는지 확인

### 연결 상태가 "연결 끊김"인 경우
- 포트 8080, 8081이 사용 중인지 확인
- 방화벽 설정 확인
- 작업 관리자에서 이전 mobi-meter.exe 프로세스 종료

### 데이터가 수집되지 않는 경우
- 게임이 실행 중인지 확인
- 관리자 권한으로 실행했는지 확인
- settings.json의 인터페이스 설정 확인

## 최신 업데이트 (v1.0.7)

### 새로운 기능
- 🎨 하이브리드 카드뷰: 상위 3명은 카드형, 나머지는 리스트형 표시
- 📊 향상된 차트: 30분 데이터 지원, 휠 줌, 평균선 및 피크 마커
- 📈 개인 DPS 추이 차트: 상세 모달에 개인별 전체 전투 DPS 그래프
- 🐱 이상한 고양이 아이콘 적용

### 개선사항
- 성능 최적화: 불필요한 애니메이션 제거, DOM 업데이트 최적화
- UI 개선: 줌 리셋 버튼 위치 및 크기 개선
- 차트 안정성: 줌 시 차트 멈춤 문제 해결

## 개발자 정보

- **프로젝트**: Mobi-Meter
- **대상 게임**: 마비노기 (한국 서버)
- **라이센스**: 개인 사용 목적
- **GitHub**: [https://github.com/JeonYuJun/mobi-meter](https://github.com/JeonYuJun/mobi-meter)

⚠️ **경고**: 이 도구는 교육 및 개인 분석 목적으로 제작되었습니다. 게임 이용약관을 확인하고 사용하시기 바랍니다.